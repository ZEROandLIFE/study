# 自定义指令区别
## **1. Vue 2 中的自定义指令**
### **基本语法**
通过 `Vue.directive()` 全局注册，或通过 `directives` 选项局部注册。

#### **全局注册**
```javascript
// main.js
Vue.directive('focus', {
  // 当绑定元素插入 DOM 时触发（仅一次）
  inserted: function (el) {
    el.focus(); // 聚焦元素
  }
});
```

#### **局部注册**
```javascript
// 组件内
export default {
  directives: {
    focus: {
      inserted(el) {
        el.focus();
      }
    }
  }
}
```

#### **使用**
```vue
<template>
  <input v-focus /> <!-- 自动聚焦 -->
</template>
```

### **钩子函数**
Vue 2 自定义指令的钩子：
- `bind`：只调用一次，指令第一次绑定到元素时调用。
- `inserted`：被绑定元素插入父节点时调用。
- `update`：所在组件的 VNode 更新时调用。
- `componentUpdated`：所在组件及其子组件全部更新后调用。
- `unbind`：只调用一次，指令与元素解绑时调用。

---

## **2. Vue 3 中的自定义指令**
### **基本语法**
Vue 3 的自定义指令 API 更接近组件生命周期，通过 `app.directive()` 全局注册，或通过 `directives` 选项局部注册。

#### **全局注册**
```javascript
// main.js
const app = createApp(App);

app.directive('focus', {
  mounted(el) {
    el.focus(); // Vue 3 的 inserted 改为 mounted
  }
});
```

#### **局部注册**
```javascript
// 组件内
export default {
  directives: {
    focus: {
      mounted(el) {
        el.focus();
      }
    }
  }
}
```

#### **使用**
```vue
<template>
  <input v-focus /> <!-- 仍然可用 -->
</template>
```

### **钩子函数变化**
Vue 3 的指令钩子更名，以对齐组件生命周期：
- `created` → 新增，在绑定元素的属性或事件监听器设置前调用。
- `beforeMount` → 新增，当指令第一次绑定到元素且在挂载父组件之前调用。
- `mounted` → 替代 Vue 2 的 `inserted`。
- `beforeUpdate` → 新增，在更新包含组件的 VNode 之前调用。
- `updated` → 替代 Vue 2 的 `componentUpdated`。
- `beforeUnmount` → 新增，在卸载元素前调用。
- `unmounted` → 替代 Vue 2 的 `unbind`。

---

## **3. 完整示例对比**
### **Vue 2 实现 `v-color` 指令**
```javascript
Vue.directive('color', {
  bind(el, binding) {
    el.style.color = binding.value;
  },
  update(el, binding) {
    el.style.color = binding.value;
  }
});
```
```vue
<template>
  <p v-color="'red'">这段文字是红色的</p>
</template>
```

### **Vue 3 实现 `v-color` 指令**
```javascript
app.directive('color', {
  mounted(el, binding) {
    el.style.color = binding.value;
  },
  updated(el, binding) {
    el.style.color = binding.value;
  }
});
```
```vue
<template>
  <p v-color="'blue'">这段文字是蓝色的</p>
</template>
```

---

## **4. 关键区别总结**
| 特性           | Vue 2                                  | Vue 3                                                                                        |
| -------------- | -------------------------------------- | -------------------------------------------------------------------------------------------- |
| **全局注册**   | `Vue.directive()`                      | `app.directive()`                                                                            |
| **局部注册**   | `directives: { ... }`                  | `directives: { ... }`                                                                        |
| **钩子函数**   | `bind`, `inserted`, `update`, `unbind` | `created`, `beforeMount`, `mounted`, `beforeUpdate`, `updated`, `beforeUnmount`, `unmounted` |
| **指令名前缀** | 必须 `v-`                              | 必须 `v-`                                                                                    |
| **动态参数**   | 支持（如 `v-directive:[arg]`）         | 支持（如 `v-directive:[arg]`）                                                               |

---

## **5. 最佳实践**
1. **优先使用 Composition API**  
   在 Vue 3 中，可以在 `setup()` 中通过 `v` 参数访问指令：
   ```javascript
   import { directive } from 'vue';

   export default {
     setup() {
       const color = directive({
         mounted(el, binding) {
           el.style.color = binding.value;
         }
       });

       return { color };
     }
   }
   ```

2. **避免过度使用指令**  
   如果逻辑较复杂，建议使用组件或 Composition API 替代。

3. **动态指令参数**  
   Vue 3 支持动态指令参数：
   ```vue
   <template>
     <div v-demo:[direction]="value"></div>
   </template>
   ```
   ```javascript
   app.directive('demo', {
     mounted(el, binding) {
       console.log(binding.arg); // direction 的值
     }
   });
   ```

---

## **总结**
- **Vue 2 和 Vue 3 都支持自定义指令**，但 Vue 3 的钩子函数更名以对齐组件生命周期。
- **Vue 3 推荐使用 `app.directive()` 全局注册**，局部注册方式不变。
- **动态指令参数**在 Vue 3 中更灵活。
- **复杂逻辑建议用组件或 Composition API** 替代指令。

