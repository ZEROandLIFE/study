# 自定义事件
## **Vue 2 中的自定义事件**
#### 1. **触发自定义事件**
在子组件中，通过 `$emit` 方法触发事件：
```javascript
// 子组件 Child.vue
export default {
  methods: {
    handleClick() {
      this.$emit('custom-event', payload); // 触发事件并传递数据
    }
  }
}
```

#### 2. **监听自定义事件**
父组件通过 `v-on`（或 `@`）监听子组件的事件：
```html
<!-- 父组件 Parent.vue -->
<template>
  <Child @custom-event="handleCustomEvent" />
</template>

<script>
export default {
  methods: {
    handleCustomEvent(payload) {
      console.log('收到子组件事件:', payload);
    }
  }
}
</script>
```

#### 3. **事件修饰符**
Vue 2 支持通过修饰符（如 `.sync`、`.native`）扩展事件行为：
- `.sync`：实现双向绑定（Vue 2.3+）。
- `.native`：监听原生 DOM 事件（Vue 3 中移除）。

#### 4. **事件总线（非推荐）**
通过全局事件总线（如 `new Vue()`）实现跨组件通信（Vue 3 中不推荐，推荐使用 `mitt` 或 `provide/inject`）。

---

## **Vue 3 中的自定义事件**
#### 1. **触发自定义事件**
语法与 Vue 2 相同，但通过 `defineEmits` 显式声明事件（Composition API）：
```javascript
// 子组件 Child.vue
<script setup>
const emit = defineEmits(['custom-event']); // 声明事件

const handleClick = () => {
  emit('custom-event', payload); // 触发事件
};
</script>
```

#### 2. **监听自定义事件**
父组件监听方式与 Vue 2 一致：
```html
<!-- 父组件 Parent.vue -->
<template>
  <Child @custom-event="handleCustomEvent" />
</template>

<script setup>
const handleCustomEvent = (payload) => {
  console.log('收到子组件事件:', payload);
};
</script>
```

#### 3. **事件修饰符的变更**
- **`.sync` 移除**：改用 `v-model` 的多个参数实现双向绑定。
- **`.native` 移除**：原生事件监听需通过 `emits` 选项或显式绑定到根元素。

#### 4. **TypeScript 支持**
`defineEmits` 支持类型声明，增强类型安全：
```javascript
<script setup lang="ts">
const emit = defineEmits<{
  (e: 'custom-event', payload: string): void;
}>();
</script>
```

#### 5. **事件传递优化**
Vue 3 的事件系统基于原生 `CustomEvent`，性能更好，且支持更复杂的传递方式（如传递函数）。

---

### **关键差异对比**
| **特性**            | **Vue 2**                 | **Vue 3**                                  |
| ------------------- | ------------------------- | ------------------------------------------ |
| **声明事件**        | 通过 `emits` 选项（可选） | 通过 `defineEmits`（Composition API 必需） |
| **TypeScript 支持** | 需手动类型推断            | 内置类型声明（`defineEmits`）              |
| **事件修饰符**      | 支持 `.sync`、`.native`   | 移除 `.sync` 和 `.native`                  |
| **事件总线**        | 可用（但不推荐）          | 不推荐，推荐其他方案                       |
| **性能优化**        | 基于 `$on`/`$emit`        | 基于原生 `CustomEvent`，更高效             |

---

### **建议**
1. **Vue 2**：
   - 使用 `$emit` 触发事件，`v-on` 监听。
   - 避免滥用事件总线，优先使用 `props`/`$emit` 或 Vuex。

2. **Vue 3**：
   - 在 Composition API 中使用 `defineEmits` 声明事件。
   - 利用 TypeScript 增强类型安全。
   - 复杂场景考虑使用 `provide/inject` 或状态管理工具（如 Pinia）。

---

### **示例代码（Vue 3 Composition API）**
```html
<!-- 子组件 Child.vue -->
<template>
  <button @click="handleClick">触发事件</button>
</template>

<script setup lang="ts">
const emit = defineEmits<{
  (e: 'update', value: number): void;
}>();

const handleClick = () => {
  emit('update', 42);
};
</script>

<!-- 父组件 Parent.vue -->
<template>
  <Child @update="handleUpdate" />
</template>

<script setup>
const handleUpdate = (value: number) => {
  console.log('收到值:', value);
};
</script>
```

