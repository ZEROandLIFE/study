# VUEX

### 一、安装与基础配置
1. **安装 Vuex**  
   通过 npm 或 yarn 安装 Vuex 3.x（Vue2 兼容版本）：
   ```bash
   npm install vuex@3 --save
   # 或
   yarn add vuex@3
   ```

2. **创建 Store**  
   在 `src/store/index.js` 中初始化 Store，并导出实例：
   ```javascript
   import Vue from 'vue';
   import Vuex from 'vuex';

   Vue.use(Vuex);

   const store = new Vuex.Store({
     state: { count: 0 }, // 初始状态
     mutations: {},        // 同步修改状态的方法
     actions: {},          // 异步操作或复杂逻辑
     getters: {},          // 计算派生状态
     modules: {}           // 模块化拆分（可选）
   });

   export default store;
   ```

3. **挂载到 Vue 实例**  
   在 `main.js` 中引入 Store 并挂载：
   ```javascript
   import Vue from 'vue';
   import App from './App.vue';
   import store from './store';

   new Vue({
     store,
     render: h => h(App)
   }).$mount('#app');
   ```

### 二、核心概念详解
#### 1. State：单一状态树
- **定义**：所有共享数据存储在 `state` 对象中。
- **访问方式**：
  - **组件内**：通过 `this.$store.state.xxx` 直接访问。
  - **模板中**：直接使用 `$store.state.xxx`。
  - **辅助函数 `mapState`**：简化计算属性映射。
    ```javascript
    import { mapState } from 'vuex';

    export default {
      computed: {
        ...mapState(['count']), // 映射为 this.count
        ...mapState({
          localCount: state => state.count // 自定义命名
        })
      }
    };
    ```

#### 2. Getters：计算派生状态
- **定义**：对 `state` 进行加工处理，类似组件的 `computed`。
- **配置示例**：
  ```javascript
  const store = new Vuex.Store({
    state: { count: 0 },
    getters: {
      doubleCount: state => state.count * 2, // 基本用法
      filteredList: (state) => (list) => {  // 带参数的 Getter
        return list.filter(item => item > state.count);
      }
    }
  });
  ```
- **访问方式**：
  - **组件内**：`this.$store.getters.xxx`。
  - **辅助函数 `mapGetters`**：
    ```javascript
    import { mapGetters } from 'vuex';

    export default {
      computed: {
        ...mapGetters(['doubleCount']), // 映射为 this.doubleCount
        ...mapGetters({ customGetter: 'filteredList' }) // 自定义命名
      }
    };
    ```

#### 3. Mutations：同步修改状态
- **定义**：唯一修改 `state` 的方法，必须是同步函数。
- **配置示例**：
  ```javascript
  const store = new Vuex.Store({
    state: { count: 0 },
    mutations: {
      increment(state) { state.count++; }, // 基本用法
      incrementBy(state, payload) { state.count += payload; }, // 带参数
      incrementObj(state, { amount, step }) { // 解构参数
        state.count += amount * step;
      }
    }
  });
  ```
- **触发方式**：
  - **组件内**：`this.$store.commit('mutationName', payload)`。
  - **辅助函数 `mapMutations`**：
    ```javascript
    import { mapMutations } from 'vuex';

    export default {
      methods: {
        ...mapMutations(['increment', 'incrementBy']), // 映射为 this.increment()
        ...mapMutations({ customIncrement: 'incrementObj' }) // 自定义命名
      }
    };
    ```

#### 4. Actions：处理异步逻辑
- **定义**：提交 `mutations` 修改状态，可包含异步操作。
- **配置示例**：
  ```javascript
  const store = new Vuex.Store({
    actions: {
      asyncIncrement({ commit }, payload) { // 解构 context.commit
        setTimeout(() => {
          commit('incrementBy', payload); // 异步后提交 mutation
        }, 1000);
      },
      async fetchData({ commit }, url) {
        const data = await fetch(url).then(res => res.json());
        commit('updateData', data); // 异步获取数据后提交
      }
    }
  });
  ```
- **触发方式**：
  - **组件内**：`this.$store.dispatch('actionName', payload)`。
  - **辅助函数 `mapActions`**：
    ```javascript
    import { mapActions } from 'vuex';

    export default {
      methods: {
        ...mapActions(['asyncIncrement', 'fetchData']), // 映射为 this.asyncIncrement()
        ...mapActions({ customAction: 'fetchData' }) // 自定义命名
      }
    };
    ```

### 三、模块化拆分（Modules）
- **场景**：当应用复杂时，将 Store 拆分为多个模块，每个模块拥有独立的 `state`、`mutations`、`actions` 和 `getters`。
- **配置示例**：
  ```javascript
  // store/modules/user.js
  const userModule = {
    namespaced: true, // 启用命名空间
    state: { name: 'Alice' },
    mutations: {
      updateName(state, newName) { state.name = newName; }
    },
    actions: {
      asyncUpdateName({ commit }, newName) {
        setTimeout(() => commit('updateName', newName), 1000);
      }
    },
    getters: {
      greeting(state) { return `Hello, ${state.name}!`; }
    }
  };

  // store/index.js
  import Vuex from 'vuex';
  import userModule from './modules/user';

  export default new Vuex.Store({
    modules: { user: userModule }
  });
  ```
- **访问方式**：
  - **组件内**：
    ```javascript
    // 访问命名空间模块的 state
    this.$store.state.user.name;

    // 提交 mutation（需指定模块名）
    this.$store.commit('user/updateName', 'Bob');

    // 分发 action
    this.$store.dispatch('user/asyncUpdateName', 'Charlie');

    // 访问 getter
    this.$store.getters['user/greeting'];
    ```
  - **辅助函数**：
    ```javascript
    import { mapState, mapMutations, mapActions, mapGetters } from 'vuex';

    export default {
      computed: {
        ...mapState('user', ['name']), // 映射为 this.name
        ...mapGetters('user', ['greeting']) // 映射为 this.greeting
      },
      methods: {
        ...mapMutations('user', ['updateName']), // 映射为 this.updateName()
        ...mapActions('user', ['asyncUpdateName']) // 映射为 this.asyncUpdateName()
      }
    };
    ```

### 四、构造时的简写技巧
1. **对象属性简写**：  
   当 `state`、`mutations`、`actions` 等为对象时，可直接省略键名：
   ```javascript
   const store = new Vuex.Store({
     state: { count: 0 }, // 等价于 state: state => ({ count: 0 })
     mutations: {
       increment(state) { state.count++; } // 等价于 mutations: { increment: function(state) { ... } }
     },
     actions: {
       asyncIncrement({ commit }) { commit('increment'); } // 解构 context.commit
     }
   });
   ```

2. **模块导出合并**：  
   将分散的模块配置合并到主 Store 中：
   ```javascript
   // store/modules/user.js
   export default {
     state: { name: 'Alice' },
     mutations: { ... }
   };

   // store/index.js
   import user from './modules/user';

   export default new Vuex.Store({
     modules: { user } // 直接传入模块对象
   });
   ```