在 Vue 2 中，**事件总线（Event Bus）** 是一种基于发布-订阅模式的轻量级跨组件通信机制，适用于非父子关系的组件（如兄弟组件、跨层级组件）之间的数据传递和事件通知。它通过一个中央事件调度中心（通常是一个空的 Vue 实例）实现组件间的解耦通信。

### **核心原理**
1. **创建事件总线**：通过 `new Vue()` 创建一个空的 Vue 实例，作为中央事件调度中心。
2. **发布事件**：组件通过 `$emit` 方法触发事件，并传递数据。
3. **订阅事件**：组件通过 `$on` 方法监听事件，并在事件触发时执行回调函数。
4. **取消订阅**：组件销毁前通过 `$off` 方法移除事件监听，避免内存泄漏。

### **实现步骤**
#### 1. 创建事件总线
在项目中创建一个独立的文件（如 `event-bus.js`），导出事件总线实例：
```javascript
// event-bus.js
import Vue from 'vue';
export const EventBus = new Vue();
```

#### 2. 发送事件（发布）
在需要发送事件的组件中，通过 `$emit` 触发事件：
```javascript
// SenderComponent.vue
import { EventBus } from './event-bus.js';

export default {
  methods: {
    sendMessage() {
      EventBus.$emit('custom-event', { message: 'Hello from Sender!' });
    }
  }
}
```

#### 3. 接收事件（订阅）
在需要接收事件的组件中，通过 `$on` 监听事件：
```javascript
// ReceiverComponent.vue
import { EventBus } from './event-bus.js';

export default {
  data() {
    return {
       receivedMessage: ''
    };
  },
  mounted() {
    EventBus.$on('custom-event', (payload) => {
      this.receivedMessage = payload.message;
      console.log('Received message:', payload);
    });
  },
  beforeDestroy() {
    // 组件销毁前移除监听，避免内存泄漏
    EventBus.$off('custom-event');
  }
}
```

#### 4. 全局挂载（可选）
如果希望所有组件都能直接通过 `this.$bus` 访问事件总线，可以在 `main.js` 中全局挂载：
```javascript
// main.js
import Vue from 'vue';
import App from './App.vue';
import { EventBus } from './event-bus.js';

Vue.prototype.$bus = EventBus;

new Vue({
  render: h => h(App),
}).$mount('#app');
```
之后，组件中可以直接使用 `this.$bus.$emit` 和 `this.$bus.$on`。

### **适用场景**
1. **非父子组件通信**：兄弟组件、跨层级组件之间的数据传递。
2. **全局事件通知**：如用户登录/登出、全局错误处理等。
3. **解耦组件**：避免组件间直接依赖，降低耦合度。
4. **简单状态变更**：不需要复杂状态管理的场景。

### **注意事项**
1. **事件命名冲突**：确保事件名称唯一，避免不同组件触发同名事件导致冲突。
2. **内存泄漏**：组件销毁前必须通过 `$off` 移除事件监听，尤其是动态监听的事件。
3. **调试困难**：事件总线是全局的，事件流可能难以追踪，建议结合日志或调试工具。
4. **替代方案**：对于复杂应用，推荐使用 Vuex（状态管理）或 Pinia（更轻量的状态管理库）替代事件总线。

### **与 Vue 3 的对比**
- **Vue 3 移除了 `$on`、`$off` 和 `$once`**：Vue 3 不再支持基于 Vue 实例的事件总线，推荐使用第三方库（如 `mitt` 或 `tiny-emitter`）实现类似功能。
- **类型安全**：Vue 3 结合 TypeScript 时，第三方库（如 `mitt`）能提供更好的类型支持。
- **设计理念**：Vue 3 更强调单向数据流和组合式 API，事件总线的使用场景被更明确的状态管理工具替代。

### **总结**
Vue 2 的事件总线是一种简单高效的跨组件通信方式，适合小型项目或简单场景。但在大型项目中，建议使用 Vuex 或 Pinia 管理状态，以提升代码的可维护性和可调试性。