Vue 3 的 `<Transition>` 是一个内置组件，用于为元素或组件的 **进入（enter）和离开（leave）** 过程添加平滑的过渡动画效果。它基于 CSS 过渡（Transition）或动画（Animation），结合 Vue 的响应式系统，能自动感知元素的状态变化（如 `v-if`、`v-show`、动态组件切换等），并触发对应的动画。

---

## **一、核心功能**
1. **自动状态检测**  
   监听元素的插入（挂载）和移除（卸载）过程，自动应用过渡效果。
2. **支持 CSS 和 JavaScript 动画**  
   - **CSS 过渡**：通过 `transition` 或 `animation` 属性实现。
   - **JavaScript 钩子**：通过回调函数实现更复杂的动画逻辑。
3. **可组合性**  
   可与 `<TransitionGroup>`（列表过渡）、`<Teleport>`（传送）等组件结合使用。

---

## **二、基本用法**
### **1. 基础 CSS 过渡**
通过 `name` 属性定义过渡类名前缀，Vue 会自动生成以下类名：
- `{name}-enter-from`：进入前的初始状态。
- `{name}-enter-active`：进入过程中的状态（定义过渡时间和曲线）。
- `{name}-enter-to`：进入后的结束状态。
- `{name}-leave-from`：离开前的初始状态。
- `{name}-leave-active`：离开过程中的状态。
- `{name}-leave-to`：离开后的结束状态。

#### **示例：淡入淡出效果**
```vue
<template>
  <button @click="show = !show">切换显示</button>
  <Transition name="fade">
    <div v-if="show" class="box">Hello Vue 3!</div>
  </Transition>
</template>

<script setup>
import { ref } from 'vue';
const show = ref(false);
</script>

<style>
/* 进入和离开的过渡效果 */
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s ease;
}
</style>
```

---

### **2. 使用 CSS 动画**
通过 `@keyframes` 定义动画，结合 `animation` 属性：
```vue
<template>
  <Transition name="bounce">
    <div v-if="show" class="box">Bounce Animation</div>
  </Transition>
</template>

<style>
.bounce-enter-active {
  animation: bounce-in 0.5s;
}
.bounce-leave-active {
  animation: bounce-in 0.5s reverse;
}

@keyframes bounce-in {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
}
</style>
```

---

## **三、高级特性**
### **1. 自定义过渡类名**
通过 `enter-active-class`、`leave-active-class` 等属性直接指定类名（兼容第三方 CSS 库如 Animate.css）：
```vue
<Transition
  enter-active-class="animate__animated animate__fadeIn"
  leave-active-class="animate__animated animate__fadeOut"
>
  <div v-if="show" class="box">使用 Animate.css</div>
</Transition>
```

### **2. JavaScript 钩子**
通过回调函数实现更复杂的动画逻辑（如使用 GSAP、Velocity.js 等库）：
```vue
<template>
  <Transition
    @before-enter="beforeEnter"
    @enter="enter"
    @leave="leave"
  >
    <div v-if="show" class="box">JavaScript 动画</div>
  </Transition>
</template>

<script setup>
import { ref } from 'vue';
const show = ref(false);

const beforeEnter = (el) => {
  el.style.transform = 'translateX(100px)';
  el.style.opacity = 0;
};

const enter = (el, done) => {
  el.animate(
    [
      { transform: 'translateX(100px)', opacity: 0 },
      { transform: 'translateX(0)', opacity: 1 }
    ],
    { duration: 500 }
  ).onfinish = done;
};

const leave = (el, done) => {
  el.animate(
    [
      { transform: 'translateX(0)', opacity: 1 },
      { transform: 'translateX(-100px)', opacity: 0 }
    ],
    { duration: 500 }
  ).onfinish = done;
};
</script>
```

### **3. 初始渲染过渡**
通过 `appear` 属性为元素的初始渲染添加过渡效果：
```vue
<Transition appear name="fade">
  <div class="box">初始渲染动画</div>
</Transition>
```

---

## **四、过渡模式（Transition Modes）**
当两个元素交替显示时（如 `v-if` 和 `v-else`），可通过 `mode` 属性控制过渡顺序：
- **`in-out`**：新元素先进入，当前元素再离开。
- **`out-in`**：当前元素先离开，新元素再进入（默认行为）。

#### **示例：模式切换**
```vue
<Transition name="fade" mode="out-in">
  <div v-if="show" key="a" class="box">A</div>
  <div v-else key="b" class="box">B</div>
</Transition>
```
> **注意**：必须为交替元素添加唯一的 `key`，否则 Vue 会复用 DOM 节点导致动画失效。

---

## **五、列表过渡（TransitionGroup）**
当需要为列表中的元素添加进入/离开动画时，使用 `<TransitionGroup>`：
```vue
<template>
  <button @click="addItem">添加项</button>
  <TransitionGroup name="list" tag="ul">
    <li v-for="item in items" :key="item.id" class="list-item">
      {{ item.text }}
    </li>
  </TransitionGroup>
</template>

<script setup>
import { ref } from 'vue';
const items = ref([
  { id: 1, text: 'Item 1' },
  { id: 2, text: 'Item 2' }
]);
let nextId = 3;

const addItem = () => {
  items.value.push({ id: nextId++, text: `Item ${nextId}` });
};
</script>

<style>
.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateY(30px);
}
.list-enter-active,
.list-leave-active {
  transition: all 0.5s ease;
}
.list-move {
  transition: transform 0.5s ease;
}
</style>
```
> **关键点**：
> - `tag` 属性指定渲染的根元素（默认为 `<span>`）。
> - `list-move` 类名用于优化列表排序时的动画性能。

---

## **六、常见问题与解决方案**
### **1. 动画不生效**
- **原因**：未正确设置 `key` 或类名拼写错误。
- **解决**：确保交替元素有唯一 `key`，并检查 CSS 类名是否匹配。

### **2. 动画闪烁**
- **原因**：初始状态未隐藏（如 `opacity: 0` 未设置）。
- **解决**：在 `*-enter-from` 和 `*-leave-to` 中明确定义初始状态。

### **3. 与 `v-show` 配合问题**
- **原因**：`v-show` 通过 `display: none` 控制显示，可能影响过渡。
- **解决**：优先使用 `v-if`，或通过 CSS 强制保留布局（如 `visibility: hidden`）。

---

## **七、完整示例代码**
```vue
<template>
  <div class="demo">
    <h2>基础过渡</h2>
    <button @click="show = !show">切换</button>
    <Transition name="fade">
      <div v-if="show" class="box">基础淡入淡出</div>
    </Transition>

    <h2>模式切换</h2>
    <Transition name="slide" mode="out-in">
      <div v-if="show" key="a" class="box">A</div>
      <div v-else key="b" class="box">B</div>
    </Transition>

    <h2>列表过渡</h2>
    <button @click="addItem">添加项</button>
    <TransitionGroup name="list" tag="ul">
      <li v-for="item in items" :key="item.id" class="list-item">
        {{ item.text }}
      </li>
    </TransitionGroup>
  </div>
</template>

<script setup>
import { ref } from 'vue';
const show = ref(true);
const items = ref([{ id: 1, text: 'Item 1' }]);
let nextId = 2;

const addItem = () => {
  items.value.push({ id: nextId++, text: `Item ${nextId}` });
};
</script>

<style>
/* 基础过渡 */
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s ease;
}

/* 模式切换 */
.slide-enter-from {
  transform: translateX(100px);
}
.slide-leave-to {
  transform: translateX(-100px);
}
.slide-enter-active,
.slide-leave-active {
  transition: all 0.5s ease;
}

/* 列表过渡 */
.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateY(30px);
}
.list-enter-active,
.list-leave-active {
  transition: all 0.5s ease;
}
.list-move {
  transition: transform 0.5s ease;
}

.box {
  margin: 20px 0;
  padding: 20px;
  background: #42b983;
  color: white;
}
.list-item {
  margin: 5px 0;
  padding: 10px;
  background: #eee;
}
</style>
```

---

## **总结**
- **用途**：为元素/组件的进入、离开、列表变化添加动画。
- **核心属性**：`name`、`mode`、`appear`、`tag`。
- **关键点**：
  - CSS 过渡需定义 `*-from` 和 `*-to` 状态。
  - 列表动画需添加唯一 `key` 和 `list-move` 类名。
  - JavaScript 钩子适合复杂动画场景。

通过 `<Transition>`，Vue 3 提供了一种声明式的方式实现动画，使代码更简洁且易于维护。