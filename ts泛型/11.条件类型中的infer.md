åœ¨ TypeScript ä¸­ï¼Œ`infer` æ˜¯**æ¡ä»¶ç±»å‹ï¼ˆConditional Typesï¼‰**ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºåœ¨ç±»å‹æ¨æ–­ï¼ˆType Inferenceï¼‰è¿‡ç¨‹ä¸­**æå–ç±»å‹å˜é‡**ã€‚å®ƒé€šå¸¸ä¸ `extends` ç»“åˆä½¿ç”¨ï¼Œç±»ä¼¼äºâ€œæ¨¡å¼åŒ¹é…â€ä¸­çš„å˜é‡æ•è·ã€‚

---

## **1. `infer` çš„åŸºæœ¬ç”¨æ³•**
### **è¯­æ³•**
```typescript
type ExtractReturnType<T> = T extends (...args: any[]) => infer R ? R : never;
```
- **`extends`**ï¼šæ£€æŸ¥ç±»å‹ `T` æ˜¯å¦ç¬¦åˆæŸç§ç»“æ„ï¼ˆè¿™é‡Œæ˜¯å‡½æ•°ç±»å‹ï¼‰ã€‚
- **`infer R`**ï¼šå¦‚æœ `T` æ˜¯å‡½æ•°ç±»å‹ï¼Œåˆ™æå–å…¶è¿”å›ç±»å‹å¹¶å‘½åä¸º `R`ã€‚
- **`? R : never`**ï¼šå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å› `R`ï¼›å¦åˆ™è¿”å› `never`ã€‚

### **ç¤ºä¾‹**
```typescript
type Func = () => number;
type ReturnType = Func extends (...args: any[]) => infer R ? R : never; // number
```
- `Func` æ˜¯ `() => number`ï¼Œæ‰€ä»¥ `infer R` æå–åˆ° `number`ã€‚
- æœ€ç»ˆ `ReturnType` æ˜¯ `number`ã€‚

---

## **2. `infer` çš„å¸¸è§åº”ç”¨åœºæ™¯**
### **(1) æå–å‡½æ•°è¿”å›ç±»å‹**
```typescript
type GetReturnType<T> = T extends (...args: any[]) => infer R ? R : never;

type Func1 = () => string;
type Func2 = (x: number) => boolean[];

type R1 = GetReturnType<Func1>; // string
type R2 = GetReturnType<Func2>; // boolean[]
```
- `GetReturnType` å¯ä»¥æå–ä»»æ„å‡½æ•°çš„è¿”å›ç±»å‹ã€‚

### **(2) æå– Promise çš„è§£æç±»å‹**
```typescript
type UnwrapPromise<T> = T extends Promise<infer R> ? R : T;

type P1 = Promise<string>;
type P2 = Promise<number[]>;

type U1 = UnwrapPromise<P1>; // string
type U2 = UnwrapPromise<P2>; // number[]
```
- `UnwrapPromise` å¯ä»¥æå– `Promise<T>` ä¸­çš„ `T`ã€‚

### **(3) æå–æ•°ç»„å…ƒç´ ç±»å‹**
```typescript
type GetArrayElement<T> = T extends (infer E)[] ? E : never;

type Arr1 = string[];
type Arr2 = (number | boolean)[];

type E1 = GetArrayElement<Arr1>; // string
type E2 = GetArrayElement<Arr2>; // number | boolean
```
- `GetArrayElement` å¯ä»¥æå–æ•°ç»„çš„å…ƒç´ ç±»å‹ã€‚

### **(4) æå–å¯¹è±¡å±æ€§çš„ç±»å‹**
```typescript
type GetPropertyType<Obj, Key extends keyof Obj> = Obj extends { [K in Key]: infer Value } ? Value : never;

type Person = { name: string; age: number };

type NameType = GetPropertyType<Person, "name">; // string
type AgeType = GetPropertyType<Person, "age">; // number
```
- `GetPropertyType` å¯ä»¥æå–å¯¹è±¡æŒ‡å®šå±æ€§çš„ç±»å‹ã€‚

---

## **3. `infer` çš„å·¥ä½œåŸç†**
`infer` ç±»ä¼¼äº**æ¨¡å¼åŒ¹é…**ä¸­çš„å˜é‡æ•è·ï¼š
- **`T extends (...args: any[]) => infer R`**ï¼š
  - æ£€æŸ¥ `T` æ˜¯å¦æ˜¯å‡½æ•°ç±»å‹ã€‚
  - å¦‚æœæ˜¯ï¼Œåˆ™æå–è¿”å›ç±»å‹å¹¶å‘½åä¸º `R`ã€‚
  - å¦‚æœä¸æ˜¯ï¼Œè¿”å› `never`ã€‚
- **`T extends Promise<infer R>`**ï¼š
  - æ£€æŸ¥ `T` æ˜¯å¦æ˜¯ `Promise` ç±»å‹ã€‚
  - å¦‚æœæ˜¯ï¼Œåˆ™æå– `Promise` çš„æ³›å‹å‚æ•° `T` å¹¶å‘½åä¸º `R`ã€‚
  - å¦‚æœä¸æ˜¯ï¼Œè¿”å› `T` æœ¬èº«ã€‚

---

## **4. `infer` çš„é™åˆ¶**
1. **åªèƒ½åœ¨ `extends` æ¡ä»¶ç±»å‹ä¸­ä½¿ç”¨**ï¼š
   - âŒ é”™è¯¯ï¼š`type R = infer R;`ï¼ˆä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼‰
   - âœ… æ­£ç¡®ï¼š`type R = T extends (...args: any[]) => infer R ? R : never;`
2. **æ¯æ¬¡åªèƒ½æ¨æ–­ä¸€ä¸ªç±»å‹å˜é‡**ï¼š
   - å¦‚æœéœ€è¦æ¨æ–­å¤šä¸ªç±»å‹å˜é‡ï¼Œå¯ä»¥åµŒå¥— `extends`ï¼š
     ```typescript
     type ExtractTuple<T> = T extends [infer First, infer Rest] ? [First, Rest] : never;
     type Tuple = [string, number];
     type Extracted = ExtractTuple<Tuple>; // [string, number]
     ```
3. **ä¸èƒ½ç”¨äºæ¥å£ï¼ˆinterfaceï¼‰æˆ–ç±»å‹åˆ«åï¼ˆtype aliasï¼‰çš„ç›´æ¥å®šä¹‰**ï¼š
   - `infer` åªèƒ½ç”¨äºæ¡ä»¶ç±»å‹ï¼ˆ`extends ? :`ï¼‰ã€‚

---

## **5. å®é™…æ¡ˆä¾‹**
### **(1) å®ç° `ReturnType`ï¼ˆTypeScript å†…ç½®ç±»å‹ï¼‰**
```typescript
type MyReturnType<T> = T extends (...args: any[]) => infer R ? R : never;

type Func = () => { name: string };
type R = MyReturnType<Func>; // { name: string }
```
- è¿™å’Œ TypeScript å†…ç½®çš„ `ReturnType` è¡Œä¸ºä¸€è‡´ã€‚

### **(2) å®ç° `Parameters`ï¼ˆæå–å‡½æ•°å‚æ•°ç±»å‹ï¼‰**
```typescript
type MyParameters<T> = T extends (...args: infer P) => any ? P : never;

type Func = (x: string, y: number) => void;
type Params = MyParameters<Func>; // [string, number]
```
- `MyParameters` å¯ä»¥æå–å‡½æ•°çš„å‚æ•°ç±»å‹ã€‚

### **(3) å®ç° `Awaited`ï¼ˆæå– `Promise` çš„è§£æç±»å‹ï¼‰**
```typescript
type MyAwaited<T> = T extends Promise<infer R> ? MyAwaited<R> : T;

type P1 = Promise<string>;
type P2 = Promise<Promise<number>>;

type A1 = MyAwaited<P1>; // string
type A2 = MyAwaited<P2>; // number
```
- `MyAwaited` å¯ä»¥é€’å½’æå– `Promise` çš„æœ€ç»ˆè§£æç±»å‹ã€‚

---

## **æ€»ç»“**
| ç‰¹æ€§               | è¯´æ˜                                                 |
| ------------------ | ---------------------------------------------------- |
| **`infer` çš„ä½œç”¨** | åœ¨æ¡ä»¶ç±»å‹ä¸­æå–ç±»å‹å˜é‡                             |
| **å¸¸è§ç”¨é€”**       | æå–å‡½æ•°è¿”å›ç±»å‹ã€`Promise` è§£æç±»å‹ã€æ•°ç»„å…ƒç´ ç±»å‹ç­‰ |
| **é™åˆ¶**           | åªèƒ½åœ¨ `extends` æ¡ä»¶ç±»å‹ä¸­ä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨        |
| **ç±»ä¼¼æ¨¡å¼åŒ¹é…**   | ç±»ä¼¼äº `switch-case` æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„æ•è·ç»„            |

`infer` æ˜¯ TypeScript ç±»å‹ç³»ç»Ÿä¸­æœ€å¼ºå¤§çš„å·¥å…·ä¹‹ä¸€ï¼Œå®ƒä½¿å¾—ç±»å‹æ¨æ–­æ›´åŠ çµæ´»ï¼Œå¯ä»¥ç”¨äºå®ç°è®¸å¤šé«˜çº§ç±»å‹æ“ä½œã€‚æŒæ¡ `infer` åï¼Œä½ å¯ä»¥å†™å‡ºæ›´å¼ºå¤§çš„ç±»å‹å·¥å…·ï¼Œå¦‚ `ReturnType`ã€`Parameters`ã€`Awaited` ç­‰ã€‚ ğŸš€